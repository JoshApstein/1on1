<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>1-1</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  </head>
  <body>
    <div class="jumbotron">
      <h1 class="text-center"> Book a 1 on 1 </h1>
    </div>
    <div class="container">
      <div class="row-fluid">
        <div class="col-md-3">Monday
          <br>
          <form class="form-inline text-center" id="mon">
              <label for="name">Name</label>
              <input type="text" style="width:100%;" class="name" placeholder="Jane Doe">
              <label for="time">Time:</label><br>
              <select class="form-control time">
                <option>3:00</option>
                <option>3:15</option>
                <option>3:30</option>
                <option>3:45</option>
              </select>
            <button type="submit" class="btn btn-default">Schedule 1-1</button>
          </form>
          <div class="row">
            <div class="col-md-12">
              3:00<ul id="mon3:00"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:15<ul id="mon3:15"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:30<ul id="mon3:30"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:45<ul id="mon3:45"></ul>
            </div>
          </div>
        </div>
        <div class="col-md-3">Tuesday
          <br>
          <form class="form-inline text-center" id="tues">
              <label for="name">Name</label>
              <input type="text" style="width:100%;" class="name" placeholder="Jane Doe"><br>
              <label for="time">Time:</label><br>
              <select class="form-control time">
                <option>3:00</option>
                <option>3:15</option>
                <option>3:30</option>
                <option>3:45</option>
              </select>
            <button type="submit" class="btn btn-default">Schedule 1-1</button>
          </form>
          <div class="row">
            <div class="col-md-12">
              3:00<ul id="tues3:00"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:15<ul id="tues3:15"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:30<ul id="tues3:30"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:45<ul id="tues3:45"></ul>
            </div>
          </div>
        </div>
        <div class="col-md-3">Wednesday
          <br>
          <form class="form-inline text-center" id="wed">
              <label for="name">Name</label>
              <input type="text" style="width:100%;" class="name" placeholder="Jane Doe"><br>
              <label for="time">Time:</label><br>
              <select class="form-control time" >
                <option>3:00</option>
                <option>3:15</option>
                <option>3:30</option>
                <option>3:45</option>
              </select>
            <button type="submit" class="btn btn-default">Schedule 1-1</button>
          </form>
          <div class="row">
            <div class="col-md-12">
              3:00<ul id="wed3:00"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:15<ul id="wed3:15"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:30<ul id="wed3:30"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:45<ul id="wed3:45"></ul>
            </div>
          </div>
        </div>
        <div class="col-md-3">Thursday
          <br>
          <form class="form-inline text-center" id="thurs">
              <label for="name">Name</label>
              <input type="text" style="width:100%;" class="name" placeholder="Jane Doe"><br>
            <label for="time">Time:</label><br>
              <select class="form-control time" >
                <option>3:00</option>
                <option>3:15</option>
                <option>3:30</option>
                <option>3:45</option>
              </select>
            <button type="submit" class="btn btn-default">Schedule 1-1</button>
          </form>
          <div class="row">
            <div class="col-md-12">
              3:00<ul id="thurs3:00"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:15<ul id="thurs3:15"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:30<ul id="thurs3:30"></ul>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">
              3:45<ul id="thurs3:45"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyA8Fl0NkFmqM_qtqARXJUl7A275Pn1eQUM",
        authDomain: "on1-8e7ba.firebaseapp.com",
        databaseURL: "https://on1-8e7ba.firebaseio.com",
        projectId: "on1-8e7ba",
        storageBucket: "on1-8e7ba.appspot.com",
        messagingSenderId: "644230306237"
      };
      firebase.initializeApp(config);
    </script>
    <script
      src="https://code.jquery.com/jquery-3.2.1.min.js"
      integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
      crossorigin="anonymous"></script>
    <script type="text/javascript">
      var studentDB = firebase.database().ref('students');
      var counterDB = firebase.database().ref();
      var provider = new firebase.auth.GithubAuthProvider();

      var counter = 2;
      var day = new Date().getDay();
      console.log('hi');
      firebase.auth().signInWithRedirect(provider);




      firebase.auth().getRedirectResult().then(function(result) {
  if (result.credential) {
    // This gives you a GitHub Access Token. You can use it to access the GitHub API.
    var token = result.credential.accessToken;
    // ...
  }
  // The signed-in user info.
  var user = result.user;
}).catch(function(error) {
  // Handle Errors here.
  var errorCode = error.code;
  var errorMessage = error.message;
  // The email of the user's account used.
  var email = error.email;
  // The firebase.auth.AuthCredential type that was used.
  var credential = error.credential;
  // ...
});
      // .then(function(result) {
      //   // This gives you a GitHub Access Token. You can use it to access the GitHub API.
      //   console.log(result.credential.accessToken);
      //   // The signed-in user info.
      //   var user = result.user;
      //   console.log(user);
      //   // ...
      // }).catch(function(error) {
      //   // Handle Errors here.
      //   var errorCode = error.code;
      //   var errorMessage = error.message;
      //   // The email of the user's account used.
      //   var email = error.email;
      //   // The firebase.auth.AuthCredential type that was used.
      //   var credential = error.credential;
      //   // ...
      // });
      if (day === 6 || day === 5) {
        studentDB.remove();
      }
      $('form').submit(function(ev) {
        ev.preventDefault();
        if (timeObj[this.id][$(this).children('.time').val()].length < 2 && !localStorage.getItem('something')){
          studentDB.push({name:$(this).children('.name').val(), time: $(this).children('.time').val(), day: this.id}).then(function() {
            // appt made
            localStorage.setItem('something', counter);
          });
        } else {
          if (localStorage.getItem('something')) alert('You can only book one slot per week');
          else alert("Booked Up, please choose another time, or day");
        }
      });
      var timeObj = {
        mon:{
          '3:00': [],
          '3:15': [],
          '3:30': [],
          '3:45': []
        }, tues:{
          '3:00': [],
          '3:15': [],
          '3:30': [],
          '3:45': []
        }, wed:{
          '3:00': [],
          '3:15': [],
          '3:30': [],
          '3:45': []
        }, thurs:{
          '3:00': [],
          '3:15': [],
          '3:30': [],
          '3:45': []
        }, fri:{
          '3:00': [],
          '3:15': [],
          '3:30': [],
          '3:45': []
        }};
      counterDB.on('value', function(snap) {
      });
      studentDB.on('child_added', function(snap) {
        var currObj = snap.val();
        if (timeObj[currObj.day][currObj.time].length < 2) {
          timeObj[currObj.day][currObj.time].push(currObj.name);
        }
        var selector = '#' + currObj.day + currObj.time.replace(/\:/, '\\3a ');
        $(selector).append('<li>' + currObj.name + '</li>');

      })
    </script>
  </body>
</html>
